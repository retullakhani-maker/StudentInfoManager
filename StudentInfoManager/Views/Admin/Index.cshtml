@model List<Core.Model.Students>

<h2>Student List</h2>

<button class="btn btn-primary mb-3" id="btnAddStudent" data-bs-toggle="modal" data-bs-target="#studentModal">Create Student</button>

<div id="studentsGrid">
    @await Html.PartialAsync("_StudentGrid", Model)
</div>

<!-- Modal -->
<div class="modal fade" id="studentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content rounded-3 shadow-lg">

            <!-- Header -->
            <div class="modal-header bg-primary text-white border-bottom">
                <h5 class="modal-title fw-semibold" id="studentModalTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Body -->
            <div class="modal-body" id="studentModalBody">
                <!-- AJAX-loaded content -->
            </div>
        </div>
    </div>
</div>
<script>
       $(document).ready(function () {
        // Load form into modal
        $('#btnAddStudent').click(function () {
            $('#studentModalTitle').text('Create Student');
            $('#studentModalBody').html('');
            $('#studentModalBody').load('/Admin/Create');
            $('#studentModal').modal('show');
        });

        // Ensure form submit is bound only once
        $(document).off('submit', '#createStudentForm').on('submit', '#createStudentForm', function (e) {
            e.preventDefault();

               var form = $(this)[0]; // raw DOM element
               var formData = new FormData(form);


            $.ajax({
                type: 'POST',
                url: '/Admin/Save',
                data: formData,
                processData: false,
                contentType: false,
                success: function () {
                    $('#studentModal').modal('hide');
                    $('body').removeClass('modal-open');
                    $('.modal-backdrop').remove();

                    refreshGrid();
                },
                error: function () {
                    alert('Error saving student.');
                }
            });
        });

         // --- Refresh grid after successful save ---
        window.refreshGrid = function () {
            $('#studentsGrid').html('Loading...');
            $.get('/Admin/LoadGrid')
                .done(function (html) {
                    $('#studentsGrid').html(html);
                })
                .fail(function () {
                    $('#studentsGrid').html('<div class="text-danger">Failed to load students.</div>');
                });
        };
    });

</script>