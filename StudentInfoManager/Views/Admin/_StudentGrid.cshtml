@model IEnumerable<Core.Model.Students>

<table id="studentTable" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Photo</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Address</th>
            <th>Phone</th>
            <th>Gender</th>
            <th>State</th>
            <th>City</th>
            <th>Birthplace</th>
            <th>DOB</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var student in Model)
        {
            <tr>
                <td>@student.PhotoPath</td>
                <td>@student.FirstName</td>
                <td>@student.LastName</td>
                <td>@student.Address</td>
                <td>@student.PhoneNumber</td>
                <td>@student.Gender</td>
                <td>@student.State?.Name</td>
                <td>@student.City?.Name</td>
                <td>@student.Birthplace</td>
                <td>@student.DateOfBirth.ToString("yyyy-MM-dd")</td>
                <td>@student.Id</td> <!-- We'll replace this in DataTable render -->
            </tr>
        }
    </tbody>
</table>
<script>
    $(document).ready(function () {
        $('#studentTable').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            responsive: true,
            pageLength: 3,
            lengthMenu: [3, 10, 25, 50, -1],
            columnDefs: [
                {
                    targets: 0, // Photo column
                    render: function (data, type, row) {
                        if (data)
                            return `<img src="${data}" width="40" height="40" />`;
                        return 'No Photo';
                    }
                },
                {
                    targets: 10, // Actions column (last column)
                    orderable: false,
                    searchable: false,
                    render: function (data, type, row) {
                        return `
                            <button class="btn btn-sm btn-warning" onclick="openEditModal('${data}')">
                                <i class="bi bi-pencil-square"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteStudent('${data}')">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        `;
                    }
                }
            ]
        });
    });

    function openEditModal(id) {
        $('#studentModalTitle').text('Edit Student');
        $('#studentModalBody').html("");
        $('#studentModal').modal('show');

        $.get('/Admin/StudentEdit/' + id, function (html) {
            $('#studentModalBody').html(html);
        }).fail(function () {
            alert('Failed to load student data.');
        });
    }

    function deleteStudent(id) {
        if (confirm('Are you sure you want to delete this student?')) {
            $.post('/Admin/StudentDelete/' + id, function () {
                $('#studentTable').DataTable().ajax.reload(); // reload table
            }).fail(function () {
                alert('Error deleting student.');
            });
        }
    }
</script>
