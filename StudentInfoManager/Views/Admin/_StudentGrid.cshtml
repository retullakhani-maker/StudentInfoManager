@model IEnumerable<Core.Model.Students>

<table id="studentTable" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Photo</th>
            <th>Name</th>
            <th>Phone</th>
            <th>City</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var student in Model)
        {
            <tr>
                <td>@student.PhotoPath</td>
                <td>@($"{student.FirstName} {student.LastName}")</td>
                <td>@student.PhoneNumber</td>
                <td>@student.City?.Name</td>
                <td>@student.Id</td> <!-- For DataTable render -->
            </tr>
        }
    </tbody>
</table>

<!-- Bootstrap Modal -->
<div class="modal fade" id="studentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="studentModalTitle">Student Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="studentModalBody">
                <!-- Student details will load here -->
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#studentTable').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            responsive: true,
            pageLength: 10,
            lengthMenu: [10, 25, 50, -1],
            columnDefs: [
                {
                    targets: 0, // Photo column
                    render: function (data) {
                        if (data)
                            return `<img src="${data}" width="40" height="40" class="rounded-circle"/>`;
                        return 'No Photo';
                    }
                },
                {
                    targets: 4, // Actions column
                    orderable: false,
                    searchable: false,
                    render: function (data) {
                        return `
                            <button class="btn btn-sm btn-info" onclick="viewDetails('${data}')">
                                <i class="bi bi-eye"></i> Details
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="openEditModal('${data}')">
                                <i class="bi bi-pencil-square"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteStudent('${data}')">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        `;
                    }
                }
            ]
        });
    });

    function viewDetails(id) {
        $('#studentModalTitle').text('Student Details');
        $('#studentModalBody').html("<p>Loading...</p>");
        $('#studentModal').modal('show');

        $.get('/Admin/StudentDetails/' + id, function (html) {
            $('#studentModalBody').html(html);
        }).fail(function () {
            alert('Failed to load student details.');
        });
    }

    function openEditModal(id) {
        $('#studentModalTitle').text('Edit Student');
        $('#studentModalBody').html("<p>Loading...</p>");
        $('#studentModal').modal('show');

        $.get('/Admin/StudentEdit/' + id, function (html) {
            $('#studentModalBody').html(html);
        }).fail(function () {
            alert('Failed to load student data.');
        });
    }

    function deleteStudent(id) {
        if (confirm('Are you sure you want to delete this student?')) {
            $.post('/Admin/StudentDelete/' + id, function () {
                location.reload();
            }).fail(function () {
                alert('Error deleting student.');
            });
        }
    }
</script>

